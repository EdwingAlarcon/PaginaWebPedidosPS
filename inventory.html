<!-- 
    M√ìDULO DE INVENTARIOS
    Sistema completo de gesti√≥n de stock, productos y movimientos
-->

<div id="inventoryModule" class="inventory-module">
    <!-- HEADER DEL M√ìDULO -->
    <div class="inventory-header">
        <h1>üì¶ Gesti√≥n de Inventarios</h1>
        <div class="inventory-actions">
            <button class="btn btn-primary" onclick="openInventoryModal('addProduct')">
                ‚ûï Nuevo Producto
            </button>
            <button class="btn btn-secondary" onclick="openInventoryModal('adjustStock')">
                üìä Ajustar Stock
            </button>
            <button class="btn btn-info" onclick="showInventoryReport()">
                üìà Reportes
            </button>
        </div>
    </div>

    <!-- TABS DE NAVEGACI√ìN -->
    <div class="inventory-tabs">
        <button class="tab-button active" onclick="switchInventoryTab('dashboard')">
            üìä Dashboard
        </button>
        <button class="tab-button" onclick="switchInventoryTab('products')">
            üì¶ Productos
        </button>
        <button class="tab-button" onclick="switchInventoryTab('movements')">
            üîÑ Movimientos
        </button>
        <button class="tab-button" onclick="switchInventoryTab('alerts')">
            ‚ö†Ô∏è Alertas
        </button>
        <button class="tab-button" onclick="switchInventoryTab('settings')">
            ‚öôÔ∏è Configuraci√≥n
        </button>
    </div>

    <!-- CONTENIDO DE LOS TABS -->
    <div class="inventory-content">

        <!-- TAB: DASHBOARD -->
        <div id="inventoryTab-dashboard" class="inventory-tab-content active">
            <div class="dashboard-grid">
                <!-- RESUMEN DE INVENTARIO -->
                <div class="dashboard-card">
                    <h3>üì¶ Total de Productos</h3>
                    <p class="stat-value" id="totalProducts">0</p>
                    <p class="stat-label">Productos registrados</p>
                </div>

                <div class="dashboard-card">
                    <h3>üí∞ Valor Total</h3>
                    <p class="stat-value" id="totalValue">$0.00</p>
                    <p class="stat-label">Valor en inventario</p>
                </div>

                <div class="dashboard-card warning">
                    <h3>‚ö†Ô∏è Stock Bajo</h3>
                    <p class="stat-value" id="lowStockCount">0</p>
                    <p class="stat-label">Productos con stock bajo</p>
                </div>

                <div class="dashboard-card critical">
                    <h3>üî¥ Stock Cr√≠tico</h3>
                    <p class="stat-value" id="criticalStockCount">0</p>
                    <p class="stat-label">Productos agotados</p>
                </div>

                <div class="dashboard-card overflow">
                    <h3>üìà Sobrestocaje</h3>
                    <p class="stat-value" id="overstockedCount">0</p>
                    <p class="stat-label">Productos con exceso</p>
                </div>

                <div class="dashboard-card">
                    <h3>‚úÖ Activos</h3>
                    <p class="stat-value" id="activeProductsCount">0</p>
                    <p class="stat-label">Productos activos</p>
                </div>
            </div>

            <!-- PRODUCTOS M√ÅS VENDIDOS -->
            <div class="dashboard-section">
                <h3>üèÜ Productos M√°s Vendidos</h3>
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>SKU</th>
                            <th>Stock</th>
                            <th>Vendidos</th>
                            <th>Ingresos</th>
                        </tr>
                    </thead>
                    <tbody id="topSellingProductsTable">
                        <tr><td colspan="5" class="empty-state">Cargando datos...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- AN√ÅLISIS POR CATEGOR√çA -->
            <div class="dashboard-section">
                <h3>üìÇ An√°lisis por Categor√≠a</h3>
                <div class="category-analysis" id="categoryAnalysisContainer">
                    <!-- Se genera din√°micamente -->
                </div>
            </div>
        </div>

        <!-- TAB: PRODUCTOS -->
        <div id="inventoryTab-products" class="inventory-tab-content">
            <div class="products-header">
                <div class="search-box">
                    <input 
                        type="text" 
                        id="productSearch" 
                        placeholder="üîç Buscar por nombre, SKU o c√≥digo de barras..."
                        onkeyup="filterInventoryProducts()"
                    />
                </div>
                <select id="categoryFilter" onchange="filterInventoryProducts()" class="filter-select">
                    <option value="">Todas las categor√≠as</option>
                    <!-- Se genera din√°micamente -->
                </select>
                <select id="statusFilter" onchange="filterInventoryProducts()" class="filter-select">
                    <option value="">Todos los estados</option>
                    <option value="activo">Activo</option>
                    <option value="inactivo">Inactivo</option>
                    <option value="descontinuado">Descontinuado</option>
                </select>
            </div>

            <div class="products-table-container">
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>SKU</th>
                            <th>Categor√≠a</th>
                            <th>Stock</th>
                            <th>M√≠n./M√°x.</th>
                            <th>Precio</th>
                            <th>Valor Total</th>
                            <th>Proveedor</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <tr><td colspan="10" class="empty-state">No hay productos. Crea uno nuevo.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB: MOVIMIENTOS -->
        <div id="inventoryTab-movements" class="inventory-tab-content">
            <div class="movements-filters">
                <div class="filter-group">
                    <label>Tipo de Movimiento:</label>
                    <select id="movementTypeFilter" onchange="filterMovements()" class="filter-select">
                        <option value="">Todos</option>
                        <option value="aumento">Entrada (+)</option>
                        <option value="disminucion">Salida (-)</option>
                        <option value="ajuste">Ajuste</option>
                        <option value="transferencia">Transferencia</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Producto:</label>
                    <select id="movementProductFilter" onchange="filterMovements()" class="filter-select">
                        <option value="">Todos los productos</option>
                        <!-- Se genera din√°micamente -->
                    </select>
                </div>

                <div class="filter-group">
                    <label>Rango de Fechas:</label>
                    <input type="date" id="movementDateFrom" onchange="filterMovements()" />
                    <span>a</span>
                    <input type="date" id="movementDateTo" onchange="filterMovements()" />
                </div>

                <button class="btn btn-secondary export-btn" onclick="exportMovements()">
                    üì• Exportar
                </button>
            </div>

            <div class="movements-table-container">
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Raz√≥n</th>
                            <th>Usuario</th>
                            <th>ID Movimiento</th>
                        </tr>
                    </thead>
                    <tbody id="movementsTableBody">
                        <tr><td colspan="7" class="empty-state">No hay movimientos registrados.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB: ALERTAS -->
        <div id="inventoryTab-alerts" class="inventory-tab-content">
            <div class="alerts-container">
                <!-- ALERTAS DE STOCK BAJO -->
                <div class="alert-section">
                    <h3>‚ö†Ô∏è Stock Bajo (Alerta)</h3>
                    <div id="lowStockAlerts" class="alerts-list">
                        <!-- Se genera din√°micamente -->
                    </div>
                </div>

                <!-- ALERTAS DE STOCK CR√çTICO -->
                <div class="alert-section">
                    <h3>üî¥ Stock Cr√≠tico (Agotado)</h3>
                    <div id="criticalStockAlerts" class="alerts-list">
                        <!-- Se genera din√°micamente -->
                    </div>
                </div>

                <!-- ALERTAS DE SOBRESTOCAJE -->
                <div class="alert-section">
                    <h3>üìà Sobrestocaje</h3>
                    <div id="overstockedAlerts" class="alerts-list">
                        <!-- Se genera din√°micamente -->
                    </div>
                </div>

                <!-- PRODUCTOS SIN MOVIMIENTO -->
                <div class="alert-section">
                    <h3>‚ùå Productos Sin Movimiento</h3>
                    <div id="slowMovingAlerts" class="alerts-list">
                        <!-- Se genera din√°micamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: CONFIGURACI√ìN -->
        <div id="inventoryTab-settings" class="inventory-tab-content">
            <div class="settings-form">
                <h3>‚öôÔ∏è Configuraci√≥n del Inventario</h3>

                <div class="form-group">
                    <label for="minStockAlert">Stock M√≠nimo para Alerta:</label>
                    <input 
                        type="number" 
                        id="minStockAlert" 
                        min="1" 
                        max="100" 
                        placeholder="Ej: 5"
                    />
                </div>

                <div class="form-group">
                    <label for="maxStockLevel">Nivel M√°ximo de Stock Permitido:</label>
                    <input 
                        type="number" 
                        id="maxStockLevel" 
                        min="100" 
                        max="10000" 
                        placeholder="Ej: 1000"
                    />
                </div>

                <div class="form-group">
                    <label for="currencySymbol">S√≠mbolo de Moneda:</label>
                    <input 
                        type="text" 
                        id="currencySymbol" 
                        placeholder="Ej: $, ‚Ç¨, ¬£"
                    />
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableNotifications" />
                        Habilitar notificaciones de stock bajo
                    </label>
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary" onclick="saveInventorySettings()">
                        üíæ Guardar Configuraci√≥n
                    </button>
                    <button class="btn btn-secondary" onclick="resetInventorySettings()">
                        üîÑ Restaurar Valores por Defecto
                    </button>
                </div>

                <hr class="divider" />

                <h3>üìã Categor√≠as de Productos</h3>
                <div id="categoriesContainer" class="categories-container">
                    <!-- Se genera din√°micamente -->
                </div>

                <div class="form-group">
                    <input 
                        type="text" 
                        id="newCategoryName" 
                        placeholder="Nombre de la nueva categor√≠a"
                    />
                    <input 
                        type="color" 
                        id="newCategoryColor" 
                        value="#007bff"
                    />
                    <button class="btn btn-success" onclick="addNewCategory()">
                        ‚ûï A√±adir Categor√≠a
                    </button>
                </div>

                <hr class="divider" />

                <h3>üíæ Copias de Seguridad</h3>
                <div class="backup-actions">
                    <button class="btn btn-info" onclick="downloadInventoryBackup()">
                        üì• Descargar Copia de Seguridad
                    </button>
                    <button class="btn btn-warning" onclick="document.getElementById('restoreBackupInput').click()">
                        üì§ Restaurar desde Archivo
                    </button>
                    <input 
                        type="file" 
                        id="restoreBackupInput" 
                        style="display:none" 
                        accept=".json"
                        onchange="restoreInventoryBackup(event)"
                    />
                </div>

                <hr class="divider" />

                <h3>üìä Exportar Datos</h3>
                <div class="export-actions">
                    <button class="btn btn-secondary" onclick="exportInventoryToCSV()">
                        üìä Exportar a CSV
                    </button>
                    <button class="btn btn-secondary" onclick="exportInventoryToJSON()">
                        üìÑ Exportar a JSON
                    </button>
                    <button class="btn btn-secondary" onclick="exportInventoryToExcel()">
                        üìà Exportar a Excel
                    </button>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- MODALES -->

<!-- MODAL: AGREGAR/EDITAR PRODUCTO -->
<div id="addProductModal" class="inventory-modal" style="display:none">
    <div class="inventory-modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Agregar Nuevo Producto</h2>
            <button class="close-btn" onclick="closeInventoryModal('addProduct')">√ó</button>
        </div>

        <form id="productForm" class="product-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="productName">Nombre del Producto *</label>
                    <input type="text" id="productName" required />
                </div>

                <div class="form-group">
                    <label for="productSKU">SKU/C√≥digo *</label>
                    <input type="text" id="productSKU" required />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="productCategory">Categor√≠a *</label>
                    <select id="productCategory" required>
                        <option value="">Seleccionar categor√≠a</option>
                        <!-- Se genera din√°micamente -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="productUnit">Unidad de Medida</label>
                    <select id="productUnit">
                        <option value="Unidad">Unidad</option>
                        <option value="Kg">Kilogramos</option>
                        <option value="L">Litros</option>
                        <option value="m">Metros</option>
                        <option value="Docena">Docena</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="productCost">Costo Unitario ($) *</label>
                    <input type="number" id="productCost" step="0.01" required />
                </div>

                <div class="form-group">
                    <label for="productPrice">Precio de Venta ($) *</label>
                    <input type="number" id="productPrice" step="0.01" required />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="productQuantity">Cantidad Inicial *</label>
                    <input type="number" id="productQuantity" min="0" required />
                </div>

                <div class="form-group">
                    <label for="productBarcode">C√≥digo de Barras</label>
                    <input type="text" id="productBarcode" />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="productMinStock">Stock M√≠nimo *</label>
                    <input type="number" id="productMinStock" min="1" required />
                </div>

                <div class="form-group">
                    <label for="productMaxStock">Stock M√°ximo *</label>
                    <input type="number" id="productMaxStock" min="1" required />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="productSupplier">Proveedor</label>
                    <input type="text" id="productSupplier" />
                </div>

                <div class="form-group">
                    <label for="productLocation">Ubicaci√≥n en Almac√©n</label>
                    <input type="text" id="productLocation" placeholder="Ej: Pasillo A, Estante 3" />
                </div>
            </div>

            <div class="form-group">
                <label for="productDescription">Descripci√≥n</label>
                <textarea id="productDescription" rows="3"></textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">üíæ Guardar Producto</button>
                <button type="button" class="btn btn-secondary" onclick="closeInventoryModal('addProduct')">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL: AJUSTAR STOCK -->
<div id="adjustStockModal" class="inventory-modal" style="display:none">
    <div class="inventory-modal-content">
        <div class="modal-header">
            <h2>Ajustar Stock</h2>
            <button class="close-btn" onclick="closeInventoryModal('adjustStock')">√ó</button>
        </div>

        <form id="adjustStockForm" class="adjust-stock-form">
            <div class="form-group">
                <label for="adjustProductSelect">Producto *</label>
                <select id="adjustProductSelect" required>
                    <option value="">Seleccionar producto</option>
                    <!-- Se genera din√°micamente -->
                </select>
            </div>

            <div id="productInfo" class="product-info" style="display:none">
                <p><strong>Stock Actual:</strong> <span id="currentStockDisplay">0</span></p>
                <p><strong>M√≠nimo:</strong> <span id="minStockDisplay">0</span> | <strong>M√°ximo:</strong> <span id="maxStockDisplay">0</span></p>
            </div>

            <div class="form-group">
                <label for="adjustType">Tipo de Ajuste *</label>
                <select id="adjustType" required>
                    <option value="">Seleccionar tipo</option>
                    <option value="aumento">üìà Entrada (Aumentar Stock)</option>
                    <option value="disminucion">üìâ Salida (Disminuir Stock)</option>
                    <option value="ajuste">üîß Ajuste Manual</option>
                </select>
            </div>

            <div class="form-group">
                <label for="adjustQuantity">Cantidad *</label>
                <input type="number" id="adjustQuantity" min="1" required />
            </div>

            <div class="form-group">
                <label for="adjustReason">Raz√≥n del Ajuste *</label>
                <input type="text" id="adjustReason" placeholder="Ej: Correcci√≥n de inventario, entrada de compra..." required />
            </div>

            <div class="form-group">
                <label for="adjustSupplier">Proveedor/Referencia (Opcional)</label>
                <input type="text" id="adjustSupplier" placeholder="Proveedor o n√∫mero de orden" />
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">‚úÖ Aplicar Ajuste</button>
                <button type="button" class="btn btn-secondary" onclick="closeInventoryModal('adjustStock')">
                    Cancelar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL: REPORTE DE INVENTARIO -->
<div id="reportModal" class="inventory-modal" style="display:none">
    <div class="inventory-modal-content large">
        <div class="modal-header">
            <h2>üìä Reporte de Inventario</h2>
            <button class="close-btn" onclick="closeInventoryModal('report')">√ó</button>
        </div>

        <div id="reportContent" class="report-content">
            <!-- Se genera din√°micamente -->
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="printInventoryReport()">
                üñ®Ô∏è Imprimir
            </button>
            <button class="btn btn-info" onclick="downloadInventoryReport()">
                üì• Descargar PDF
            </button>
        </div>
    </div>
</div>
