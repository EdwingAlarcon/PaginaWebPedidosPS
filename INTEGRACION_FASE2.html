<!-- FASE 2: MÃ“DULOS INTEGRADOS -->
<!-- Este es el orden correcto de cargas para la aplicaciÃ³n modular -->

<!-- 1. VARIABLES DE ENTORNO (primero) -->
<script>
    // Cargar variables de entorno si existen
    if (typeof window.ENV === 'undefined') {
        window.ENV = {};
        // Intentar cargar desde .env.local (simulado con localStorage)
        const envData = localStorage.getItem('appConfig');
        if (envData) {
            try {
                window.ENV = JSON.parse(envData);
            } catch (e) {
                console.warn('Error parsing app config');
            }
        }
    }
</script>

<!-- 2. MSALJS (Microsoft Authentication) -->
<script src="https://alcdn.msauth.net/browser/2.26.0/js/msal-browser.min.js"></script>

<!-- 3. CONFIG MODULE (ConfiguraciÃ³n centralizada) -->
<script src="src/config/config.js"></script>

<!-- 4. SECURITY MODULES (Seguridad - necesario antes de procesamiento de datos) -->
<script src="js/utils/sanitize.js"></script>
<script src="js/utils/validation.js"></script>

<!-- 5. CORE MODULES (MÃ³dulos principales) -->
<script src="src/modules/auth.js"></script>
<script src="src/modules/inventory.js"></script>
<script src="src/modules/excel.js"></script>
<script src="src/modules/forms.js"></script>
<script src="src/modules/ui.js"></script>

<!-- 6. APPLICATION ENTRY POINT (Inicializador principal) -->
<script src="src/main.js"></script>

<!-- 7. ORIGINAL APP (Para compatibilidad backward - OPCIONAL) -->
<!-- <script src="js/app.js"></script> -->

<!-- 
NOTA IMPORTANTE:
- El sistema Fase 2 es completamente modular y no requiere app.js
- Si necesitas funcionalidad antigua de app.js, puedes cargar como Ãºltimo script
- El orden de carga es crucial para que los mÃ³dulos funcionen correctamente
-->

<!-- DIAGNOSTICS SCRIPT (Para debugging en consola) -->
<script>
    window.DiagnosticTools = {
        // Ver estado de mÃ³dulos
        status: function() {
            return {
                Config: !!window.Config,
                AuthManager: !!window.AuthManager,
                InventoryManager: !!window.InventoryManager,
                ExcelManager: !!window.ExcelManager,
                FormManager: !!window.FormManager,
                UIManager: !!window.UIManager,
                SecurityUtils: !!window.SecurityUtils,
                ValidationUtils: !!window.ValidationUtils,
                App: !!window.App,
                AppInitialized: window.App?.isInitialized
            };
        },

        // InformaciÃ³n de debug
        debug: function() {
            console.group('ğŸ” DIAGNOSTIC REPORT');
            console.log('Modules Status:', this.status());
            console.log('Config:', window.Config?.getFullConfig());
            console.log('Current User:', window.AuthManager?.getCurrentUser());
            console.log('Inventory Count:', window.InventoryManager?.getAll().length);
            console.log('Statistics:', window.InventoryManager?.getStatistics());
            console.groupEnd();
        },

        // Reinicializar app
        reinitialize: async function() {
            console.log('ğŸ”„ Reinitializing application...');
            window.App = new Application();
            await window.App.initialize();
            console.log('âœ… Reinitialization complete');
        },

        // Test todos los mÃ³dulos
        testAll: async function() {
            console.group('ğŸ§ª MODULE TESTS');
            
            // Test Config
            try {
                const config = window.Config.getFullConfig();
                console.log('âœ… Config: OK', config);
            } catch (e) {
                console.error('âŒ Config: FAILED', e);
            }

            // Test Auth
            try {
                const isAuth = window.AuthManager?.isAuthenticated();
                console.log(`âœ… Auth: ${isAuth ? 'Authenticated' : 'Not authenticated'}`);
            } catch (e) {
                console.error('âŒ Auth: FAILED', e);
            }

            // Test Inventory
            try {
                const count = window.InventoryManager?.getAll().length || 0;
                console.log(`âœ… Inventory: OK (${count} items)`);
            } catch (e) {
                console.error('âŒ Inventory: FAILED', e);
            }

            // Test UI
            try {
                const stats = window.InventoryManager?.getStatistics();
                console.log('âœ… UI: OK', stats);
            } catch (e) {
                console.error('âŒ UI: FAILED', e);
            }

            console.groupEnd();
        },

        // Comandos Ãºtiles
        help: function() {
            console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           DIAGNOSTIC TOOLS - FASE 2 MODULAR                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ Comandos disponibles:

  DiagnosticTools.status()        â†’ Ver estado de mÃ³dulos
  DiagnosticTools.debug()         â†’ Reporte completo de debug
  DiagnosticTools.testAll()       â†’ Probar todos los mÃ³dulos
  DiagnosticTools.reinitialize()  â†’ Reinicializar app
  DiagnosticTools.help()          â†’ Este mensaje

ğŸ” Ejemplos de uso:

  // Verificar si estÃ¡s autenticado
  window.AuthManager?.isAuthenticated()

  // Ver todos los pedidos
  window.InventoryManager?.getAll()

  // Agregar nuevo pedido
  await window.FormManager?.handleAddOrder({ clientName: 'Juan', ... })

  // Actualizar tabla
  window.UIManager?.updateInventoryTable(...)

  // Sincronizar con Excel
  await window.ExcelManager?.syncInventory()

ğŸ’¡ Para mÃ¡s informaciÃ³n, revisa:
   - src/modules/ (mÃ³dulos)
   - src/config/config.js (configuraciÃ³n)
   - src/main.js (orquestador)

            `);
        }
    };

    // Mostrar mensaje al cargar
    console.log('%câ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 'color: #0078d4');
    console.log('%câ•‘     PAGINAWEBPEDIDOSPS v2.0 - FASE 2 MODULAR                  â•‘', 'color: #0078d4');
    console.log('%câ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'color: #0078d4');
    console.log('%cPara diagnosticar, ejecuta: DiagnosticTools.help()', 'color: #107c10; font-weight: bold');
</script>
